name: ğŸŒ™ Mystic Daily Commit

on:
  schedule:
    - cron: '0 0 * * *'   
  workflow_dispatch:

jobs:
  commit:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout the repo
        uses: actions/checkout@v4

      - name: Generate mystic quote and fortune and append to README
        run: |
          quotes=(
            "ğŸŒ’ æœˆå½±æºã‚Œã€è¨€è‘‰ã¯é¢¨ã«æ¶ˆã‚†ã€‚"
            "ğŸŒ“ é™å¤œã«ã€æ˜Ÿã®å£°ãŒèƒ¸ã‚’æ‰“ã¤ã€‚"
            "ğŸŒ• é›²ã‚’å‰²ã‚Šã€ç™½ãæœˆã€ãŸã ç‹¬ã‚Šã€‚"
            "ğŸŒ˜ é³¥ã‚‚çœ ã‚‹ã€å¤œã®åº•ã«å¤¢ã²ã¨ã¤ã€‚"
            "ğŸŒ‘ é—‡ã‚’æŠ±ãã€å…‰ã¯ãªãŠç”Ÿã¾ã‚Œãã‚‹ã€‚"
            "ğŸŒ™ é¢¨èŠ±èˆã„ã€éå»ã¨æœªæ¥ã‚’ç¹‹ãã€‚"
            "ğŸŒ— å¤¢ã®è·¡ã€æœˆã ã‘ãŒã™ã¹ã¦ã‚’è¦‹ã¦ã„ãŸã€‚"
            "ğŸŒ– æ³¡æ²«ã®ã”ã¨ãã€æƒ³ã„ã¯æ˜‡è¯ã™ã€‚"
            "ğŸŒ” ç™½éœ²è½ã¡ã€è¨˜æ†¶ã®èˆŸã¯å²¸ã‚’é›¢ã‚‹ã€‚"
            "ğŸŒ‘ è¦‹ãˆã¬ã‚‚ã®ã“ãã€å¿ƒã‚’ç…§ã‚‰ã™ã€‚"
          )

          fortunes=(
            "ğŸŒŸ ä»Šæ—¥ã®é‹å‹¢ï¼šå¤§å‰ â€” ä¸‡äº‹é †èª¿ã€å¿ƒé™å¦‚æ°´ã€‚"
            "ğŸŒ ä»Šæ—¥ã®é‹å‹¢ï¼šä¸­å‰ â€” æœ‰æ”¶è·ï¼Œä½†éœ€è°¨æ…è¡Œäº‹ã€‚"
            "ğŸŒ¤ï¸ ä»Šæ—¥ã®é‹å‹¢ï¼šå°å‰ â€” ç»†é›¨æ¶¦ç‰©ï¼Œè“„åŠ¿å¾…å‘ã€‚"
            "ğŸŒ«ï¸ ä»Šæ—¥ã®é‹å‹¢ï¼šæœ«å‰ â€” è¿è½¬å¾®å¦™ï¼Œå‹¿æ€¥å‹¿èºã€‚"
            "ğŸŒ§ï¸ ä»Šæ—¥ã®é‹å‹¢ï¼šå‡¶ â€” å‡¡äº‹ä¸å¼ºæ±‚ï¼Œé™è§‚å…¶å˜ã€‚"
          )

          QUOTE=${quotes[$RANDOM % ${#quotes[@]}]}
          FORTUNE=${fortunes[$RANDOM % ${#fortunes[@]}]}
          DATE=$(date '+%Y-%m-%d')

          NEW_CONTENT=$(cat << EOM
           <!-- daily-fortune-start -->
           <div id="daily-fortune">
             $QUOTE<br>
             $FORTUNE<br>
             ğŸ—“ï¸$DATE
           </div>
           <!-- daily-fortune-end -->
          EOM
          )

          # æŠŠæ–°çš„å†…å®¹ä¿å­˜åˆ°æ–‡ä»¶ä¸­
          echo "$NEW_CONTENT" > tmp_daily.txt

          # åˆ é™¤åŸæœ‰ daily-fortune å—ï¼ˆåŒ…æ‹¬èµ·å§‹å’Œç»“æŸæ³¨é‡Šï¼‰
          sed -i '/<!-- daily-fortune-start -->/,/<!-- daily-fortune-end -->/d' README.md

          # åœ¨ <!-- daily-fortune-start --> è¿™ä¸€è¡Œåæ’å…¥æ–°å†…å®¹
          sed -i '/<!-- daily-fortune-start -->/r tmp_daily.txt' README.md

          # åˆ é™¤ä¸´æ—¶æ–‡ä»¶
          rm tmp_daily.txt



      - name: Commit and push changes
        env:
          TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          git config --global user.name "Qimin-Shen"
          git config --global user.email "qimshen@bu.edu"
          git remote set-url origin https://x-access-token:${TOKEN}@github.com/${{ github.repository }}
          git add README.md
          git commit -m "ğŸŒŒ Mystic update on $(date '+%Y-%m-%d')" || echo "No changes to commit"
          git push origin main
